# MB25 Registration Bot

Бот для регистрации выпускников на конференцию МБ25 с использованием aiogram 3.x и aiogram-dialog.

## Возможности бота

1. **Приветствие** - Приветственное сообщение для выпускников
2. **Выбор пакета участия** - 3 варианта участия:
   - Деловая программа (3 000р)
   - Гала-ужин (3 500р) 
   - Деловая программа и гала-ужин (6 000р)
3. **Сбор персональных данных**:
   - Имя и фамилия
   - Информация об участии в МБ ранее
   - Информация о выпуске из ВШМ
4. **Сохранение в базу данных** PostgreSQL
5. **Хранение состояний в Redis**

## Технологии

- **Python 3.13**
- **aiogram 3.12.0** - Telegram Bot API framework
- **aiogram-dialog 2.2.0** - Диалоговая система для создания интерактивных ботов
- **SQLAlchemy 2.0.43** - ORM для работы с базой данных
- **PostgreSQL** - База данных (с psycopg драйвером)
- **Redis** - Хранение состояний FSM
- **environs** - Управление конфигурацией через переменные окружения

## Установка и запуск

### 1. Клонирование репозитория
```bash
git clone <repository_url>
cd MB_prog_bot
```

### 2. Установка зависимостей
```bash
python3 -m pip install -r requirements.txt
```

### 3. Настройка переменных окружения

Создайте файл `.env` в корне проекта:
```env
# Bot Token
BOT_TOKEN=your_bot_token_here

# Database
DB_USER=your_db_user
DB_PASS=your_db_password
DB_NAME=your_db_name
DB_HOST=your_db_host
DB_PORT=5432

# Redis
REDIS_HOST=your_redis_host
REDIS_PORT=6379
REDIS_PASSWORD=your_redis_password

LOG_LEVEL=INFO
```

### 4. Запуск бота
```bash
python3 main.py
```

## Структура проекта

```
MB_prog_bot/
├── main.py                 # Точка входа в приложение
├── requirements.txt        # Зависимости проекта
├── .env                   # Переменные окружения (не в git)
├── config/
│   └── config.py          # Конфигурация приложения
└── bot/
    ├── __init__.py
    ├── models.py          # Модели базы данных
    ├── database.py        # Работа с базой данных
    ├── states.py          # FSM состояния
    ├── dialogs.py         # Диалоги aiogram-dialog
    ├── handlers.py        # Обработчики команд
    └── middlewares.py     # Middleware для передачи зависимостей
```

## Описание работы бота

### Поток регистрации:

1. **Команда /start** - Показывает приветственное сообщение
2. **Кнопка "Как можно поучаствовать?"** - Переход к выбору пакета
3. **Выбор пакета участия** - Пользователь выбирает один из 3 пакетов
4. **Ввод имени** - Пользователь вводит своё имя
5. **Ввод фамилии** - Пользователь вводит свою фамилию
6. **Вопрос об участии в МБ ранее** - Да/Нет
7. **Год участия** (если участвовал) - Ввод года участия
8. **Вопрос о выпуске из ВШМ** - Да/Нет
9. **Год выпуска** (если выпускник) - Ввод года выпуска
10. **Завершение** - Сообщение о успешной регистрации

### Модель данных

Таблица `users`:
- `id` - Автоинкремент ID
- `telegram_id` - Уникальный Telegram ID пользователя
- `first_name` - Имя
- `last_name` - Фамилия
- `package_type` - Тип пакета (business/gala/full)
- `participated_before` - Участвовал ли в МБ ранее
- `participation_year` - Год участия (если участвовал)
- `is_vsm_graduate` - Выпускник ли ВШМ
- `graduation_year` - Год выпуска (если выпускник)
- `created_at` - Дата создания записи
- `updated_at` - Дата обновления записи

## Команды для разработки

### Сброс диалога (для тестирования)
Отправьте `/reset` боту для сброса текущего диалога и начала заново.

### Просмотр логов
Бот выводит подробные логи в консоль, включая:
- SQL запросы (SQLAlchemy echo=True)
- Подключения к Redis и PostgreSQL
- Информацию о сохранении пользователей

## Возможные расширения

1. **Админ-панель** - Добавить админские команды для просмотра статистики
2. **Экспорт данных** - Экспорт зарегистрированных пользователей в Excel/CSV
3. **Уведомления** - Система уведомлений о начале продаж
4. **Валидация** - Более строгая валидация вводимых данных
5. **Локализация** - Поддержка разных языков

## Лицензия

MIT License